{% extends "base.html" %}

{% block title %}Artist Details - Spotify Stop AI{% endblock %}

{% block content %}
<div class="card">
    <h2>üé§ {{ artist.name }}</h2>
    <p class="timestamp">Spotify ID: {{ artist.id }}</p>
    
    {% if override %}
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Override Active:</strong> This artist is manually classified as 
        {% if override.is_artificial %}AI Generated{% else %}Human{% endif %}
        {% if override.reason %}<br>Reason: {{ override.reason }}{% endif %}
        
        <form method="post" action="/override/{{ artist.id }}/delete" style="display: inline; margin-left: 1rem;">
            <button type="submit" class="btn btn-danger">Remove Override</button>
        </form>
    </div>
    {% endif %}
</div>

<div class="card">
    <h3>üîÑ Reclassify Artist</h3>
    <form method="post" action="/reclassify/{{ artist.id }}">
        <input type="hidden" name="artist_name" value="{{ artist.name }}">
        <button type="submit" class="btn">Run Classification Now</button>
    </form>
</div>

<div class="card">
    <h3>‚öôÔ∏è Set Manual Override</h3>
    <form method="post" action="/override/{{ artist.id }}">
        <div class="form-group">
            <label for="is_artificial">Classification:</label>
            <select name="is_artificial" id="is_artificial" required>
                <option value="true">AI Generated</option>
                <option value="false">Human Artist</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="reason">Reason (optional):</label>
            <textarea name="reason" id="reason" rows="3" placeholder="Why are you setting this override?"></textarea>
        </div>
        
        <button type="submit" class="btn">Set Override</button>
    </form>
</div>

<div class="card">
    <h3>ü§ñ Classification History ({{ decisions|length }})</h3>
    {% if decisions %}
    {% for decision in decisions %}
    <div class="source-result" style="margin-bottom: 1.5rem;">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div>
                <div class="source-name" style="font-size: 1.1rem;">
                    Decision: {{ decision.label }}
                    {% if decision.is_artificial == 1 %}
                    <span class="badge badge-ai">AI Generated</span>
                    {% elif decision.is_artificial == 0 %}
                    <span class="badge badge-human">Human</span>
                    {% else %}
                    <span class="badge badge-unknown">Unknown</span>
                    {% endif %}
                </div>
                <div class="timestamp">{{ decision.timestamp }}</div>
            </div>
            <div class="confidence" style="font-size: 1.1rem;">
                Confidence: {{ "%.0f"|format(decision.confidence * 100) }}%
            </div>
        </div>
        
        {% if decision.reason %}
        <div style="margin-bottom: 0.5rem;">
            <strong>Reason:</strong> {{ decision.reason }}
        </div>
        {% endif %}
        
        {% if decision.citations %}
        <div style="margin-bottom: 0.5rem;">
            <strong>Citations:</strong> {{ decision.citations }}
        </div>
        {% endif %}
        
        {% if decision.contexts %}
        <details style="margin-top: 1rem;">
            <summary style="cursor: pointer; color: #1db954; font-weight: 600;">
                üìä Source Details ({{ decision.contexts|length }} sources)
            </summary>
            <div style="margin-top: 1rem;">
                {% for context in decision.contexts %}
                <div style="background: #181818; padding: 0.75rem; margin: 0.5rem 0; border-radius: 4px;">
                    <div class="source-name">{{ context.source_name }}</div>
                    <div>Result: {{ context.result }}</div>
                    {% if context.signals %}
                    <div>Signals: {{ context.signals }}</div>
                    {% endif %}
                    {% if context.tags %}
                    <div>Tags: {{ context.tags }}</div>
                    {% endif %}
                    {% if context.url %}
                    <div><a href="{{ context.url }}" target="_blank">View Source</a></div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </details>
        {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <p style="color: #b3b3b3;">No classification decisions recorded for this artist yet.</p>
    {% endif %}
</div>

<div class="card">
    <h3>üìä Recent Plays ({{ plays|length }})</h3>
    {% if plays %}
    <table>
        <thead>
            <tr>
                <th>Track</th>
                <th>Time</th>
                <th>Skipped</th>
            </tr>
        </thead>
        <tbody>
            {% for play in plays %}
            <tr>
                <td>{{ play.track_name }}</td>
                <td class="timestamp">{{ play.timestamp }}</td>
                <td>{% if play.skipped %}‚úÖ Yes{% else %}‚ùå No{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #b3b3b3;">No plays recorded for this artist yet.</p>
    {% endif %}
</div>

<div style="margin-top: 2rem;">
    <a href="/" class="btn btn-secondary">‚Üê Back to Home</a>
</div>
{% endblock %}
